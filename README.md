# æ™ºèƒ½å†™ä½œå¹³å° - å®Œæ•´å·¥ä½œæµåº”ç”¨

ä¸€ä¸ªåŸºäº Next.js çš„æ™ºèƒ½å†™ä½œå¹³å°ï¼Œæ•´åˆäº†é£æ ¼æ¨¡ä»¿ã€æ–‡ç« ç”Ÿæˆå’Œæ‰‹å†™è½¬æ¢ä¸‰å¤§åŠŸèƒ½ï¼Œæ”¯æŒä»ä¸»é¢˜è¾“å…¥åˆ°æ‰‹å†™ä½œæ–‡è¾“å‡ºçš„å®Œæ•´å·¥ä½œæµã€‚

> âš ï¸ **æ³¨æ„**ï¼š
> - **æ‰‹å†™ç”ŸæˆAPI**: `https://unpermeative-anamaria-famously.ngrok-free.dev/coze/generate`
> - **Ollama API**: `https://4e9abcf1a8c0.ngrok-free.app`ï¼ˆè¿œç¨‹æœåŠ¡ï¼‰
> å¦‚éœ€ä½¿ç”¨å…¶ä»–APIï¼Œå¯åœ¨ç•Œé¢çš„"é«˜çº§è®¾ç½®"ä¸­ä¿®æ”¹ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ å®Œæ•´å·¥ä½œæµï¼ˆæ–°ï¼‰
1. **é£æ ¼åˆ†æ** - åˆ†æç”¨æˆ·æä¾›çš„é£æ ¼æ ·æœ¬ï¼Œæå–è¯­è¨€ç‰¹å¾ï¼ˆStyle DNAï¼‰
2. **æ–‡ç« ç”Ÿæˆ** - æ ¹æ®ä¸»é¢˜å’Œé£æ ¼ç‰¹å¾ç”Ÿæˆæ¨¡ä»¿æ–‡ç« 
3. **æ‰‹å†™è½¬æ¢** - å°†ç”Ÿæˆçš„æ–‡ç« è½¬æ¢ä¸ºæ‰‹å†™é£æ ¼å›¾ç‰‡

### ğŸ“ é£æ ¼æ¨¡ä»¿ (Style Mimic)
- æ™ºèƒ½åˆ†ææ–‡æœ¬è¯­è¨€ç‰¹å¾
- æå– Style DNAï¼ˆå¥é•¿ã€è¿‡æ¸¡è¯ã€è¯æ±‡å¤æ‚åº¦ç­‰ï¼‰
- åŸºäºé£æ ¼ç‰¹å¾ç”Ÿæˆæ¨¡ä»¿æ–‡ç« 
- æ”¯æŒè‡ªå®šä¹‰åˆ›é€ æ€§å‚æ•°

### âœï¸ æ‰‹å†™ç”Ÿæˆ (Handwriting Generator)
- æ™ºèƒ½åˆ†æ®µå¤„ç†é•¿æ–‡æœ¬
- æ”¯æŒè‡ªå®šä¹‰ç¬”è¿¹é£æ ¼
- å¯è°ƒæ•´ç”Ÿæˆå‚æ•°
- æ— è¶…æ—¶é™åˆ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pnpm install
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

åº”ç”¨å°†åœ¨ http://localhost:5000 ä¸Šè¿è¡Œã€‚

## ğŸ“– ä½¿ç”¨è¯´æ˜

### å®Œæ•´å·¥ä½œæµæ¨¡å¼

1. **è¾“å…¥å†™ä½œä¸»é¢˜**
   - åœ¨"å†™ä½œä¸»é¢˜"æ¡†ä¸­è¾“å…¥ä½ æƒ³è¦çš„æ–‡ç« ä¸»é¢˜
   - ä¾‹å¦‚ï¼š"äººå·¥æ™ºèƒ½åœ¨æ•™è‚²ä¸­çš„åº”ç”¨"

2. **ï¼ˆå¯é€‰ï¼‰æä¾›é£æ ¼æ ·æœ¬**
   - ç²˜è´´ä¸€æ®µä½ å–œæ¬¢çš„å†™ä½œé£æ ¼æ–‡æœ¬
   - ç³»ç»Ÿä¼šåˆ†æå¹¶æ¨¡ä»¿è¿™ç§é£æ ¼

3. **ï¼ˆå¯é€‰ï¼‰ä¸Šä¼ ç¬”è¿¹å›¾ç‰‡**
   - é€‰æ‹©ä¸€å¼ ä½ å–œæ¬¢çš„ç¬”è¿¹å›¾ç‰‡
   - ç³»ç»Ÿä¼šæ¨¡ä»¿è¿™ç§æ‰‹å†™é£æ ¼

4. **è°ƒæ•´å‚æ•°**
   - **ç”Ÿæˆæ¸©åº¦**ï¼šæ§åˆ¶æ–‡ç« çš„åˆ›é€ æ€§ï¼ˆ0.5-2.0ï¼‰
   - **æ‰‹å†™æ­¥éª¤æ•°**ï¼šå½±å“æ‰‹å†™è´¨é‡ï¼ˆ8-20ï¼‰

5. **ç”Ÿæˆ**
   - ç‚¹å‡»"å®Œæ•´å·¥ä½œæµ"æŒ‰é’®
   - ç­‰å¾…ç³»ç»Ÿè‡ªåŠ¨å®Œæˆæ–‡ç« ç”Ÿæˆå’Œæ‰‹å†™è½¬æ¢
   - é¢„è§ˆå¹¶ä¸‹è½½æœ€ç»ˆçš„æ‰‹å†™ä½œæ–‡

### åˆ†æ­¥æ¨¡å¼

ä½ ä¹Ÿå¯ä»¥é€‰æ‹©åˆ†æ­¥æ“ä½œï¼š

1. **ä»…ç”Ÿæˆæ–‡ç« **
   - ç‚¹å‡»"ä»…ç”Ÿæˆæ–‡ç« "æŒ‰é’®
   - é¢„è§ˆç”Ÿæˆçš„æ–‡ç« 
   - æ»¡æ„åç‚¹å‡»"è½¬æ¢ä¸ºæ‰‹å†™"

2. **ä»…æ‰‹å†™è½¬æ¢**
   - åˆ‡æ¢åˆ°"ä»…æ‰‹å†™è½¬æ¢"æ ‡ç­¾
   - è¾“å…¥æ–‡æœ¬å¹¶ä¸Šä¼ ç¬”è¿¹å›¾ç‰‡
   - ç›´æ¥ç”Ÿæˆæ‰‹å†™é£æ ¼

## ğŸ”§ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 16 (App Router)
- **UI ç»„ä»¶**: shadcn/ui
- **æ ·å¼**: Tailwind CSS 4
- **å›¾åƒå¤„ç†**: Sharp
- **è¯­è¨€**: TypeScript
- **å¤§è¯­è¨€æ¨¡å‹**: coze-coding-dev-sdk (è±†åŒ…)

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ style-mimic/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts              # é£æ ¼æ¨¡ä»¿API
â”‚   â”‚   â”œâ”€â”€ handwriting/
â”‚   â”‚   â”‚   â””â”€â”€ generate/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts          # æ‰‹å†™ç”ŸæˆAPI
â”‚   â”‚   â””â”€â”€ workflow/
â”‚   â”‚       â””â”€â”€ complete/
â”‚   â”‚           â””â”€â”€ route.ts          # å®Œæ•´å·¥ä½œæµAPI
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ WritingWorkflow.tsx           # å®Œæ•´å·¥ä½œæµç»„ä»¶
â”‚   â”œâ”€â”€ HandwritingGenerator.tsx     # æ‰‹å†™ç”Ÿæˆå™¨ç»„ä»¶
â”‚   â””â”€â”€ ui/                           # shadcn/ui ç»„ä»¶
â””â”€â”€ lib/
    â””â”€â”€ style-analyzer.ts             # Style DNA åˆ†æå·¥å…·
```

## ğŸ”‘ API æ¥å£

### POST /api/style-mimic

åˆ†æé£æ ¼å¹¶ç”Ÿæˆæ–‡ç« ã€‚

**è¯·æ±‚ä½“**:

```json
{
  "topic": "å†™ä½œä¸»é¢˜",
  "style_sample": "é£æ ¼æ ·æœ¬æ–‡æœ¬ï¼ˆå¯é€‰ï¼‰",
  "temperature": 1.2
}
```

**å“åº”**:

```json
{
  "success": true,
  "article": "ç”Ÿæˆçš„æ–‡ç« å†…å®¹",
  "style_dna": {
    "avg_sent_len": 24.5,
    "transitions": ["however", "thus"],
    "quirks": ["And/But starters"],
    "vocabulary_level": "moderate",
    "sentence_structures": {
      "simple": 0.3,
      "compound": 0.5,
      "complex": 0.2
    },
    "tone": "formal"
  },
  "message": "æ–‡ç« ç”ŸæˆæˆåŠŸ"
}
```

### POST /api/workflow/complete

æ‰§è¡Œå®Œæ•´å·¥ä½œæµï¼šé£æ ¼æ¨¡ä»¿ + æ‰‹å†™è½¬æ¢ã€‚

**è¯·æ±‚ä½“**:

```json
{
  "topic": "å†™ä½œä¸»é¢˜",
  "style_sample": "é£æ ¼æ ·æœ¬æ–‡æœ¬ï¼ˆå¯é€‰ï¼‰",
  "handwriting_image": "base64ç¬”è¿¹å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰",
  "temperature": 1.2,
  "steps": 12,
  "guidance_scale": 2.0,
  "max_segment_chars": 200,
  "api_endpoint": "è‡ªå®šä¹‰APIç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰"
}
```

**å“åº”**:

```json
{
  "success": true,
  "article": "ç”Ÿæˆçš„æ–‡ç« å†…å®¹",
  "result_image_base64": "data:image/png;base64,...",
  "style_dna": { ... },
  "message": "å®Œæ•´å·¥ä½œæµæ‰§è¡ŒæˆåŠŸï¼šæ–‡ç« ç”Ÿæˆ + æ‰‹å†™è½¬æ¢",
  "steps": {
    "style_mimic": {
      "success": true,
      "style_dna_applied": true
    },
    "handwriting": {
      "success": true,
      "segments_count": 3
    }
  }
}
```

### POST /api/handwriting/generate

å°†æ–‡æœ¬è½¬æ¢ä¸ºæ‰‹å†™é£æ ¼å›¾ç‰‡ã€‚

**è¯·æ±‚ä½“**:

```json
{
  "input_text": "è¦è½¬æ¢çš„æ–‡æœ¬",
  "style_image": "base64é£æ ¼å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰",
  "steps": 12,
  "guidance_scale": 2.0,
  "max_segment_chars": 200,
  "api_endpoint": "è‡ªå®šä¹‰APIç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰"
}
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### Style DNA åˆ†æ

è‡ªåŠ¨åˆ†ææ–‡æœ¬çš„è¯­è¨€é£æ ¼ç‰¹å¾ï¼š

- **å¹³å‡å¥é•¿**: å¥å­çš„å¹³å‡å­—ç¬¦æ•°
- **è¿‡æ¸¡è¯**: å¸¸ç”¨çš„è¿æ¥è¯
- **è¯­è¨€ä¹ æƒ¯**: ç‰¹æ®Šçš„å†™ä½œä¹ æƒ¯
- **è¯æ±‡å¤æ‚åº¦**: simple / moderate / high
- **å¥å¼åˆ†å¸ƒ**: ç®€å•å¥ã€å¤åˆå¥ã€å¤æ‚å¥çš„æ¯”ä¾‹
- **è¯­æ°”åŸºè°ƒ**: formal / casual / critical / positive / neutral

### æ™ºèƒ½æ–‡ç« ç”Ÿæˆ

1. **ç”Ÿæˆå¤§çº²** - æ ¹æ®ä¸»é¢˜åˆ›å»ºç»“æ„åŒ–æ®µè½å¤§çº²
2. **é€æ®µç”Ÿæˆ** - ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹é€æ®µç”Ÿæˆå†…å®¹
3. **ä¿æŒè¿è´¯** - é€šè¿‡å‰æ–‡æ‘˜è¦ç¡®ä¿æ®µè½é—´è¿è´¯
4. **é£æ ¼æ¨¡ä»¿** - æ ¹æ® Style DNA è°ƒæ•´è¯­è¨€é£æ ¼

### æ‰‹å†™å›¾ç‰‡è½¬æ¢

1. **æ™ºèƒ½åˆ†æ®µ** - è‡ªåŠ¨å°†é•¿æ–‡æœ¬åˆ†æ®µå¤„ç†
2. **é£æ ¼åº”ç”¨** - ä½¿ç”¨ä¸Šä¼ çš„ç¬”è¿¹å›¾ç‰‡ä½œä¸ºå‚è€ƒ
3. **å‚ç›´æ‹¼æ¥** - å°†å¤šæ®µå›¾ç‰‡æ‹¼æ¥æˆå®Œæ•´ç»“æœ
4. **æ— è¶…æ—¶** - æ”¯æŒé•¿æ—¶é—´è¿è¡Œ

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

1. **æ¨¡ä»¿åäººå†™ä½œé£æ ¼**
   - è¾“å…¥åäººçš„æ–‡ç« ç‰‡æ®µ
   - ç”Ÿæˆç›¸åŒé£æ ¼çš„æ–°æ–‡ç« 

2. **ç»Ÿä¸€å†™ä½œé£æ ¼**
   - æ”¶é›†å›¢é˜Ÿå·²æœ‰çš„æ–‡æ¡£
   - ç”Ÿæˆé£æ ¼ä¸€è‡´çš„æ–°å†…å®¹

3. **åˆ›æ„å†™ä½œè¾…åŠ©**
   - æä¾›åˆ›æ„ä¸»é¢˜
   - AI ç”Ÿæˆå®Œæ•´æ–‡ç« 
   - è½¬æ¢ä¸ºæ‰‹å†™é£æ ¼å±•ç¤º

4. **æ•™å­¦æ¼”ç¤º**
   - ç”Ÿæˆç¤ºä¾‹æ–‡ç« 
   - å±•ç¤ºä¸åŒå†™ä½œé£æ ¼
   - æ‰‹å†™æ•ˆæœæ›´çœŸå®

## âš™ï¸ å‚æ•°è¯´æ˜

### æ–‡ç« ç”Ÿæˆå‚æ•°

| å‚æ•° | èŒƒå›´ | è¯´æ˜ |
|------|------|------|
| temperature | 0.5-2.0 | ç”Ÿæˆåˆ›é€ æ€§ï¼Œè¶Šé«˜è¶Šæœ‰åˆ›æ„ |
| - | 0.5-0.8 | ç¨³å®šã€è¿è´¯ |
| - | 0.9-1.2 | å¹³è¡¡ï¼ˆæ¨èï¼‰ |
| - | 1.3-2.0 | åˆ›æ„ã€å¤šæ · |

### æ‰‹å†™ç”Ÿæˆå‚æ•°

| å‚æ•° | èŒƒå›´ | è¯´æ˜ |
|------|------|------|
| steps | 8-20 | ç”Ÿæˆæ­¥éª¤æ•°ï¼Œå½±å“è´¨é‡ |
| guidance_scale | 1.0-5.0 | å¼•å¯¼æ¯”ä¾‹ï¼Œæ§åˆ¶é£æ ¼å¼ºåº¦ |
| max_segment_chars | 100-500 | åˆ†æ®µé˜ˆå€¼ |

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é£æ ¼æ ·æœ¬è´¨é‡**
   - æä¾›çš„é£æ ¼æ ·æœ¬åº”å…·æœ‰ä¸€å®šçš„ä»£è¡¨æ€§
   - å»ºè®®è‡³å°‘ 200 å­—
   - é¿å…åŒ…å«è¿‡å¤šæ ¼å¼å­—ç¬¦

2. **ç¬”è¿¹å›¾ç‰‡**
   - å»ºè®®ä½¿ç”¨æ¸…æ™°çš„ç¬”è¿¹å›¾ç‰‡
   - æ”¯æŒ JPGã€PNG ç­‰å¸¸è§æ ¼å¼
   - å›¾ç‰‡å¤§å°å»ºè®®ä¸è¶…è¿‡ 5MB

3. **ç”Ÿæˆæ—¶é—´**
   - æ–‡ç« ç”Ÿæˆï¼šçº¦ 30-60 ç§’
   - æ‰‹å†™è½¬æ¢ï¼šå–å†³äºæ–‡æœ¬é•¿åº¦
   - å®Œæ•´å·¥ä½œæµï¼šçº¦ 1-3 åˆ†é’Ÿ

4. **å†…å®¹è´¨é‡**
   - ç”Ÿæˆå†…å®¹åŸºäº AI æ¨¡å‹
   - å»ºè®®äººå·¥å®¡æ ¸åå†ä½¿ç”¨
   - å¯å¤šæ¬¡ç”Ÿæˆé€‰æ‹©æœ€ä½³ç‰ˆæœ¬

## ğŸ¤ æ‰©å±•åŠŸèƒ½

### Ollama API é…ç½®

åº”ç”¨ä½¿ç”¨ **Ollama API** è¿›è¡Œé£æ ¼æ¨¡ä»¿å’Œæ–‡ç« ç”Ÿæˆï¼Œå½“å‰é…ç½®ä¸ºè¿œç¨‹ ngrok æœåŠ¡ã€‚

**å½“å‰é…ç½®ï¼š**
```
Ollama APIç«¯ç‚¹: https://4e9abcf1a8c0.ngrok-free.app
```

**æœåŠ¡ä¿¡æ¯ï¼š**
- **ä½ç½®**: è¿œç¨‹æœåŠ¡ï¼ˆé€šè¿‡ ngrok æš´éœ²ï¼‰
- **æ¨¡å‹**: `ghostwriter:latest`ï¼ˆå·²å®‰è£…ï¼‰
- **API è·¯å¾„**: `/api/generate`ï¼ˆæ ‡å‡† Ollama APIï¼‰

**å¦‚éœ€ä½¿ç”¨å…¶ä»– Ollama æœåŠ¡åœ°å€ï¼Œå¯åœ¨ç•Œé¢çš„"é«˜çº§è®¾ç½®"ä¸­ä¿®æ”¹ Ollama API ç«¯ç‚¹ï¼š**

**æœ¬åœ°æœåŠ¡ç¤ºä¾‹ï¼š**
```
Ollama APIç«¯ç‚¹: http://localhost:11434
```

**Prompt æ ¼å¼ï¼š**

åº”ç”¨ä½¿ç”¨ä»¥ä¸‹æ ‡å‡†åŒ–çš„ prompt æ ¼å¼è°ƒç”¨ Ollamaï¼š

```
### Instruction:
{instruction}

### Input:
> - Style_DNA: {style_dna_json}

Current_Outline_Point: {outline_point}
Previous_Context: {previous_context}

### Response:
```

**é‡è¦å‚æ•°ï¼š**
- **æ¨¡å‹åç§°**: `ghostwriter`ï¼ˆå¿…é¡»é¢„å…ˆåœ¨ Ollama ä¸­å®‰è£…ï¼‰
- **æ¸©åº¦å‚æ•°**: 1.5ï¼ˆé«˜åˆ›é€ æ€§ï¼‰
- **å…¶ä»–å‚æ•°**:
  - `top_p`: 0.95
  - `repeat_penalty`: 1.2
  - `presence_penalty`: 0.8
  - `stop`: ["###", "</s>"]

**Style_DNA æ ¼å¼ï¼š**

```json
{
  "avg_sent_len": 12.5,
  "transitions": ["Frankly", "Believe me"],
  "quirks": ["Superlative-heavy", "Punchy fragments"],
  "vocabulary_level": "moderate",
  "sentence_structures": {
    "simple": 0.4,
    "compound": 0.3,
    "complex": 0.3
  },
  "tone": "casual"
}
```

**å®‰è£…æ¨¡å‹ï¼š**
```bash
ollama pull ghostwriter
```

### æ‰‹å†™ç”Ÿæˆ API é…ç½®

åº”ç”¨å·²é»˜è®¤é…ç½®æ‰‹å†™ç”ŸæˆAPIç«¯ç‚¹ï¼š`https://unpermeative-anamaria-famously.ngrok-free.dev/coze/generate`

å¦‚éœ€ä½¿ç”¨å…¶ä»–APIï¼Œå¯åœ¨ç•Œé¢çš„"é«˜çº§è®¾ç½®"ä¸­ä¿®æ”¹ API ç«¯ç‚¹ï¼š

```
APIç«¯ç‚¹: https://unpermeative-anamaria-famously.ngrok-free.dev/coze/generate
```

**è¯·æ±‚æ ¼å¼ï¼š**

```json
{
  "input_text": "Hello World",
  "style_image": "iVBORw0KGgoAAAANSUhEUgAA...",
  "steps": 12,
  "guidance_scale": 2.0
}
```

**å‚æ•°è¯´æ˜ï¼š**
- `input_text` (å¿…éœ€): è¦è½¬æ¢ä¸ºæ‰‹å†™çš„æ–‡æœ¬å†…å®¹
- `style_image` (å¯é€‰): Base64ç¼–ç çš„é£æ ¼å›¾ç‰‡æ•°æ®ï¼ˆ**ä¸å«** `data:image/xxx;base64,` å‰ç¼€ï¼‰
- `steps` (å¯é€‰): ç”Ÿæˆæ­¥éª¤æ•°ï¼Œé»˜è®¤12ï¼ŒèŒƒå›´5-50
- `guidance_scale` (å¯é€‰): å¼•å¯¼æ¯”ä¾‹ï¼Œé»˜è®¤2.0ï¼ŒèŒƒå›´1.0-5.0

**å“åº”æ ¼å¼ï¼š**

```json
{
  "success": true,
  "result_image_url": "http://example.com/generated/handwriting.png",
  "result_image_base64": "iVBORw0KGgoAAAANSUhEUgAA...",
  "message": "Handwriting generated successfully",
  "error": null
}
```

**ä½¿ç”¨å»ºè®®ï¼š**
- å¿«é€Ÿæµ‹è¯•: ä½¿ç”¨ steps=5-8
- è´¨é‡å¹³è¡¡: ä½¿ç”¨ steps=12-15
- é«˜è´¨é‡: ä½¿ç”¨ steps=18-30
- é•¿æ–‡æœ¬: è¶…è¿‡200å­—ç¬¦ä¼šè‡ªåŠ¨åˆ†æ®µå¤„ç†
- è¶…æ—¶å¤„ç†: å»ºè®®ä¸è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´

## ğŸ“„ License

MIT

## ğŸ™ è‡´è°¢

- åŸºäº [style-mimic.skill](https://coze.com) å’Œ [handwriting-generator-segmented.skill](https://coze.com) æ”¹ç¼–
- ä½¿ç”¨ [Next.js](https://nextjs.org) æ„å»º
- UI ç»„ä»¶æ¥è‡ª [shadcn/ui](https://ui.shadcn.com)
- å¤§è¯­è¨€æ¨¡å‹é›†æˆæ¥è‡ª [coze-coding-dev-sdk](https://coze.com)
